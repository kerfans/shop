<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
//默认后台控制器
class Admin extends CI_Controller {

    public function __construct()
    {
        parent::__construct();

        //$this->load->library('session');
        $this->load->helper('url');
        $this->load->model('usermodel');
        session_start();
    }

    //载入登陆页或者是后台页面
	public function index()
	{

        if(isset($_SESSION['username'])){
            $this->load->view('admin/admin_tpl');
        }else{
            $this->load->view('admin/login_tpl');
        }
	}

    //处理登录请求
    public function login()
    {
        $data=array();
            $res=$this->usermodel->get_one_user($_REQUEST['username'],$_REQUEST['password']);
            if($res){
                $_SESSION['username']=$_REQUEST['username'];
                $_SESSION['shenfen']=$res[0]['u_type']==0?"京卫客服":($res[0]['u_type']==1?"京卫门店客服":"门店人员");
                $_SESSION['url']=$res[0]['u_type']==0?"left_beida":($res[0]['u_type']==1?"left_yiji":"left_erji");
                $_SESSION['u_id']=$res[0]['u_id'];
                $_SESSION['u_pid']=$res[0]['u_pid'];
                $_SESSION['u_type']=$res[0]['u_type'];
                $_SESSION['is_next']=$res[0]['is_next'];
                $_SESSION['password_url']=SITE."user/update_password";
                $_SESSION['where']=$res[0]['u_pid']==0?"and 1=1":"and s.shop_id=".$res[0]['u_pid'];
                redirect('/admin/index','location');
            }else{
                $data['mess']="用户名或密码错误";
                $this->load->view('admin/login_tpl', $data);
            }
    }

    //退出登录
    public function logout(){
        session_destroy();
        redirect('/admin/index','location');
    }

    //载入顶部视图
    public function top()
    {
        $this->load->view('admin/top_tpl');
    }

    //载入左边贝达视图
    public function left_beida()
    {
        $this->load->view('admin/left_tpl');
    }

    //载入左边一级经销商视图
    public function left_yiji()
    {
        $this->load->view('admin/left_yiji_tpl');
    }

    //载入左边二级经销商视图
    public function left_erji()
    {
        $this->load->view('admin/left_erji_tpl');
    }

    //载入中间的收缩条
    public function left_center()
    {
        $this->load->view('admin/left_center_tpl.php');
    }
    //载入右边主体视图
    public function right()
    {
        $this->load->view('admin/right_tpl');
    }
    //重写父类中的方法
    function access(){}
}
?>
